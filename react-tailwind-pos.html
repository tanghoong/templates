<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toast POS System</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const menuItems = [
            { id: 'D001', name: 'Espresso', price: 2.50, category: 'Coffee' },
            { id: 'D002', name: 'Latte', price: 3.50, category: 'Coffee' },
            { id: 'D003', name: 'Cappuccino', price: 3.50, category: 'Coffee' },
            { id: 'D004', name: 'Americano', price: 3.00, category: 'Coffee' },
            { id: 'D005', name: 'Green Tea', price: 2.50, category: 'Tea' },
            { id: 'D006', name: 'Earl Grey', price: 2.50, category: 'Tea' },
            { id: 'D007', name: 'Chai Latte', price: 3.50, category: 'Tea' },
            { id: 'D008', name: 'Orange Juice', price: 3.00, category: 'Juice' },
            { id: 'D009', name: 'Apple Juice', price: 3.00, category: 'Juice' },
            { id: 'D010', name: 'Smoothie', price: 4.50, category: 'Juice' },
            { id: 'D011', name: 'Iced Tea', price: 2.50, category: 'Cold Drinks' },
            { id: 'D012', name: 'Lemonade', price: 3.00, category: 'Cold Drinks' },
            { id: 'B001', name: 'Sourdough Toast', price: 3.50, category: 'Bread' },
            { id: 'B002', name: 'Whole Wheat Toast', price: 3.00, category: 'Bread' },
            { id: 'B003', name: 'Bagel', price: 2.50, category: 'Bread' },
            { id: 'B004', name: 'Croissant', price: 2.75, category: 'Bread' },
        ];

        const tables = [
            { id: 1, name: 'Table 1' },
            { id: 2, name: 'Table 2' },
            { id: 3, name: 'Table 3' },
            { id: 4, name: 'Table 4' },
            { id: 5, name: 'Table 5' },
        ];

        function App() {
            const [cart, setCart] = useState([]);
            const [activeCategory, setActiveCategory] = useState('All');
            const [total, setTotal] = useState(0);
            const [orderType, setOrderType] = useState(null);
            const [selectedTable, setSelectedTable] = useState(null);
            const [darkMode, setDarkMode] = useState(false);
            const [pastOrders, setPastOrders] = useState([]);
            const [showPastOrders, setShowPastOrders] = useState(false);
            const [showCart, setShowCart] = useState(false);
            const [showPaymentOptions, setShowPaymentOptions] = useState(false);
            const [notification, setNotification] = useState(null);
            const [unpaidOrders, setUnpaidOrders] = useState([]);
            const [archivedOrders, setArchivedOrders] = useState([]);
            const [activeView, setActiveView] = useState('new-order');

            const categories = ['All', ...new Set(menuItems.map(item => item.category))];

            useEffect(() => {
                const newTotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                setTotal(newTotal);
            }, [cart]);

            useEffect(() => {
                const savedPastOrders = localStorage.getItem('pastOrders');
                if (savedPastOrders) {
                    setPastOrders(JSON.parse(savedPastOrders));
                }
                const savedDarkMode = localStorage.getItem('darkMode');
                if (savedDarkMode) {
                    setDarkMode(JSON.parse(savedDarkMode));
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('pastOrders', JSON.stringify(pastOrders));
            }, [pastOrders]);

            useEffect(() => {
                localStorage.setItem('darkMode', JSON.stringify(darkMode));
            }, [darkMode]);

            useEffect(() => {
                const savedUnpaidOrders = localStorage.getItem('unpaidOrders');
                const savedArchivedOrders = localStorage.getItem('archivedOrders');
                if (savedUnpaidOrders) setUnpaidOrders(JSON.parse(savedUnpaidOrders));
                if (savedArchivedOrders) setArchivedOrders(JSON.parse(savedArchivedOrders));
            }, []);

            useEffect(() => {
                localStorage.setItem('unpaidOrders', JSON.stringify(unpaidOrders));
            }, [unpaidOrders]);

            useEffect(() => {
                localStorage.setItem('archivedOrders', JSON.stringify(archivedOrders));
            }, [archivedOrders]);

            const startNewOrder = () => {
                if (cart.length > 0) {
                    const confirmDiscard = window.confirm("You have items in your cart. Are you sure you want to start a new order? This will discard the current order.");
                    if (!confirmDiscard) return;
                }
                setCart([]);
                setOrderType(null);
                setSelectedTable(null);
                setActiveCategory('All');
                setShowPastOrders(false);
                setShowCart(false);
                setActiveView('new-order');
            };

            const addToCart = (item) => {
                const existingItem = cart.find(cartItem => cartItem.id === item.id);
                if (existingItem) {
                    setCart(cart.map(cartItem => 
                        cartItem.id === item.id ? { ...cartItem, quantity: cartItem.quantity + 1 } : cartItem
                    ));
                } else {
                    setCart([...cart, { ...item, quantity: 1 }]);
                }
            };

            const updateQuantity = (id, newQuantity) => {
                if (newQuantity === 0) {
                    setCart(cart.filter(item => item.id !== id));
                } else {
                    setCart(cart.map(item => 
                        item.id === id ? { ...item, quantity: newQuantity } : item
                    ));
                }
            };

            const filteredItems = activeCategory === 'All' 
                ? menuItems 
                : menuItems.filter(item => item.category === activeCategory);

            const handlePayment = (paymentMethod, payLater = false) => {
                if (orderType === 'dine-in' && !selectedTable) {
                    alert('Please select a table for dine-in orders.');
                    return;
                }
                const newOrder = {
                    id: Date.now(),
                    date: new Date().toLocaleString(),
                    type: orderType,
                    table: selectedTable ? selectedTable.name : null,
                    items: cart,
                    total: total,
                    paymentMethod: payLater ? 'Unpaid' : paymentMethod,
                };
                if (payLater) {
                    setUnpaidOrders(prevOrders => [newOrder, ...prevOrders]);
                    setNotification(`Order added to unpaid orders`);
                } else {
                    setPastOrders(prevOrders => [newOrder, ...prevOrders]);
                    setNotification(`Payment successful via ${paymentMethod}`);
                }
                setCart([]);
                setOrderType(null);
                setSelectedTable(null);
                setShowPaymentOptions(false);
                setShowCart(false);
                setTimeout(() => setNotification(null), 3000);
            };

            const toggleArchiveOrder = (orderId, currentList, setCurrentList, targetList, setTargetList) => {
                const orderIndex = currentList.findIndex(order => order.id === orderId);
                if (orderIndex !== -1) {
                    const [movedOrder] = currentList.splice(orderIndex, 1);
                    setCurrentList([...currentList]);
                    setTargetList(prevList => [movedOrder, ...prevList]);
                }
            };

            const archiveOrder = (orderId) => {
                toggleArchiveOrder(orderId, pastOrders, setPastOrders, archivedOrders, setArchivedOrders);
            };

            const unarchiveOrder = (orderId) => {
                toggleArchiveOrder(orderId, archivedOrders, setArchivedOrders, pastOrders, setPastOrders);
            };

            const renderOrderList = (orders, isArchived = false) => (
                <div>
                    {orders.map(order => (
                        <div key={order.id} className={`mb-4 p-4 rounded ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow`}>
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-2">
                                <span className="text-sm">{order.date}</span>
                                <span className="text-sm">{order.type} {order.table && `- ${order.table}`}</span>
                            </div>
                            {order.items.map(item => (
                                <div key={item.id} className="flex justify-between text-sm">
                                    <span>{item.name} x{item.quantity}</span>
                                    <span>${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            ))}
                            <div className="mt-2 flex justify-between items-center">
                                <span className="font-bold">Total: ${order.total.toFixed(2)}</span>
                                <span className="text-sm">Paid via: {order.paymentMethod}</span>
                                <button 
                                    onClick={() => isArchived ? unarchiveOrder(order.id) : archiveOrder(order.id)}
                                    className={`px-2 py-1 text-sm rounded ${isArchived ? 'bg-blue-500' : 'bg-yellow-500'} text-white`}
                                >
                                    {isArchived ? 'Unarchive' : 'Archive'}
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            );

            return (
                <div className={`flex flex-col h-screen ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-100'}`}>
                    <header className={`flex justify-between items-center p-4 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow`}>
                        <nav className="flex space-x-2">
                            <button 
                                onClick={startNewOrder}
                                className={`px-3 py-1 md:px-4 md:py-2 text-sm md:text-base rounded ${activeView === 'new-order' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
                            >
                                <i className="fas fa-plus mr-1"></i>New Order
                            </button>
                            <button 
                                onClick={() => setActiveView('unpaid-orders')}
                                className={`px-3 py-1 md:px-4 md:py-2 text-sm md:text-base rounded ${activeView === 'unpaid-orders' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
                            >
                                Unpaid Orders <span className="bg-red-500 text-white rounded-full px-2 py-1 text-xs">{unpaidOrders.length}</span>
                            </button>
                            <button 
                                onClick={() => setActiveView('archived-orders')}
                                className={`px-3 py-1 md:px-4 md:py-2 text-sm md:text-base rounded ${activeView === 'archived-orders' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
                            >
                                Archived Orders <span className="bg-red-500 text-white rounded-full px-2 py-1 text-xs">{archivedOrders.length}</span>
                            </button>
                            <button 
                                onClick={() => setActiveView('past-orders')}
                                className={`px-3 py-1 md:px-4 md:py-2 text-sm md:text-base rounded ${activeView === 'past-orders' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`}
                            >
                                Past Orders <span className="bg-red-500 text-white rounded-full px-2 py-1 text-xs">{pastOrders.length}</span>
                            </button>
                            <button 
                                onClick={() => setDarkMode(!darkMode)}
                                className={`px-3 py-1 md:px-4 md:py-2 text-sm md:text-base rounded ${darkMode ? 'bg-yellow-400 text-gray-900' : 'bg-gray-800 text-white'}`}
                            >
                                <i className={`fas ${darkMode ? 'fa-sun' : 'fa-moon'}`}></i>
                            </button>
                        </nav>
                    </header>
                    <main className="flex-1 flex overflow-hidden">
                        <div className="flex-1 overflow-y-auto p-4">
                            {activeView === 'new-order' && (
                                <div>
                                    {!orderType && (
                                        <div className="mb-4 flex flex-wrap gap-2">
                                            <button 
                                                onClick={() => setOrderType('dine-in')}
                                                className={`px-4 py-2 rounded ${darkMode ? 'bg-blue-600' : 'bg-blue-500'} text-white`}
                                            >
                                                Dine In
                                            </button>
                                            <button 
                                                onClick={() => setOrderType('takeaway')}
                                                className={`px-4 py-2 rounded ${darkMode ? 'bg-green-600' : 'bg-green-500'} text-white`}
                                            >
                                                Takeaway
                                            </button>
                                        </div>
                                    )}
                                    {orderType === 'dine-in' && !selectedTable && (
                                        <div className="mb-4">
                                            <h2 className="text-lg font-bold mb-2">Select a Table:</h2>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
                                                {tables.map(table => (
                                                    <button
                                                        key={table.id}
                                                        onClick={() => setSelectedTable(table)}
                                                        className={`p-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-white hover:bg-gray-100'}`}
                                                    >
                                                        {table.name}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    {orderType && (selectedTable || orderType === 'takeaway') && (
                                        <div>
                                            <div className="mb-4 flex flex-wrap gap-2">
                                                {categories.map(category => (
                                                    <button 
                                                        key={category}
                                                        onClick={() => setActiveCategory(category)}
                                                        className={`px-3 py-1 text-sm rounded ${
                                                            activeCategory === category 
                                                                ? (darkMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white')
                                                                : (darkMode ? 'bg-gray-700 text-white' : 'bg-white text-blue-500')
                                                        }`}
                                                    >
                                                        {category}
                                                    </button>
                                                ))}
                                            </div>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                                {filteredItems.map(item => (
                                                    <button
                                                        key={item.id}
                                                        onClick={() => addToCart(item)}
                                                        className={`p-2 rounded shadow text-center ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-white hover:bg-gray-50'}`}
                                                    >
                                                        <div className="font-bold text-sm">{item.name}</div>
                                                        <div className="text-sm">${item.price.toFixed(2)}</div>
                                                        <div className="text-xs text-gray-500">{item.id}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                            {activeView === 'unpaid-orders' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-4">Unpaid Orders</h2>
                                    {renderOrderList(unpaidOrders)}
                                </div>
                            )}
                            {activeView === 'archived-orders' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-4">Archived Orders</h2>
                                    {renderOrderList(archivedOrders, true)}
                                </div>
                            )}
                            {activeView === 'past-orders' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-4">Past Orders</h2>
                                    {renderOrderList(pastOrders)}
                                </div>
                            )}
                        </div>
                        {activeView === 'new-order' && (showCart || window.innerWidth >= 768) && (
                            <div className={`w-full md:w-80 ${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-lg overflow-y-auto`}>
                                <div className="p-4">
                                    <h2 className="text-lg font-bold mb-4">Cart</h2>
                                    {cart.map(item => (
                                        <div key={item.id} className="flex justify-between items-center mb-2">
                                            <span className="text-sm">{item.name}</span>
                                            <div>
                                                <button onClick={() => updateQuantity(item.id, item.quantity - 1)} className={`px-2 py-1 text-sm rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>-</button>
                                                <span className="mx-2 text-sm">{item.quantity}</span>
                                                <button onClick={() => updateQuantity(item.id, item.quantity + 1)} className={`px-2 py-1 text-sm rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-200'}`}>+</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-4 border-t">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="font-bold">Total:</span>
                                        <span className="font-bold">${total.toFixed(2)}</span>
                                    </div>
                                    <button 
                                        onClick={() => setShowPaymentOptions(true)}
                                        className={`w-full py-2 rounded ${darkMode ? 'bg-green-600 hover:bg-green-700' : 'bg-green-500 hover:bg-green-600'} text-white`}
                                        disabled={cart.length === 0 || !orderType}
                                    >
                                        Pay
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>
                    {showPaymentOptions && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <div className={`p-4 rounded-lg ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                <h2 className="text-lg font-bold mb-4">Select Payment Method</h2>
                                <div className="space-y-2">
                                    <button onClick={() => handlePayment('Cash')} className="w-full py-2 bg-green-500 text-white rounded">Cash</button>
                                    <button onClick={() => handlePayment('Credit Card')} className="w-full py-2 bg-blue-500 text-white rounded">Credit Card</button>
                                    <button onClick={() => handlePayment('Online Banking')} className="w-full py-2 bg-purple-500 text-white rounded">Online Banking</button>
                                    <button onClick={() => handlePayment('', true)} className="w-full py-2 bg-yellow-500 text-white rounded">Pay Later</button>
                                </div>
                                <button onClick={() => setShowPaymentOptions(false)} className="mt-4 w-full py-2 bg-gray-300 text-gray-800 rounded">Cancel</button>
                            </div>
                        </div>
                    )}
                    {notification && (
                        <div className="fixed bottom-4 right-4 bg-green-500 text-white p-2 rounded shadow">
                            {notification}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>